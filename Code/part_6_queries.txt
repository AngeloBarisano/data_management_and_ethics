-- Create a VIEW with the time components split up



-- Create a View that identifies the resource intensive crimes by proportion of ARRESTS by IUCR!; 
-- THEN USE THOSE WITH THE HIGHEST PROPORTION TO INDEX ALL CRIMES THAT FALL UNDER THIS
-- i) get resource intensive crimes; so calculate: arrest proportion by CrimeType
-- count all crime types


--ii) now count arrests == TRUE by crime type
SELECT PrimaryCategory, COUNT(*) AS ArrestCount
FROM CriminalCase AS CC JOIN CrimeType AS CT ON CC.IUCR == CT.IUCR
WHERE CC.Arrest == 'True'
GROUP BY PrimaryCategory;


-- iii) merge the two queries above 
SELECT PrimaryCat_tot.PrimaryCategory, ArrestCount, TotalCommitted, ROUND(CAST(CAST(ArrestCount AS REAL) / CAST(TotalCommitted AS REAL) AS REAL) * 100, 2) AS ProportionArrested
FROM (SELECT PrimaryCategory, COUNT(*) AS TotalCommitted
FROM CriminalCase AS CC JOIN CrimeType AS CT ON CC.IUCR == CT.IUCR
GROUP BY PrimaryCategory) AS PrimaryCat_tot
JOIN 
(SELECT PrimaryCategory, COUNT(*) AS ArrestCount
FROM CriminalCase AS CC JOIN CrimeType AS CT ON CC.IUCR == CT.IUCR
WHERE CC.Arrest == 'True'
GROUP BY PrimaryCategory) AS PrimaryCat_arr ON PrimaryCat_tot.PrimaryCategory == PrimaryCat_arr.PrimaryCategory ;
-- NOW TRY TO USE A WINDOW FUNCTION FOR THIS
-- ESSENTIALLY RANK by crime 



-- Question 1: Location By time:


-- 1) Total Crime count in general by district

-- Total Crimes by District over total time
SELECT District, COUNT(*)
FROM CriminalCase AS CC INNER JOIN Location L ON L.Beat = CC.Beat
GROUP BY District, ;


-- Total Primary Crimes by District over total time
SELECT District, PrimaryCategory, COUNT(*)
FROM CriminalCase AS CC INNER JOIN CrimeType as CT ON CC.IUCR = CT.IUCR INNER JOIN Location AS L ON L.Beat = CC.Beat
GROUP BY District, PrimaryCategory;






-- rank district by average crime count aggregated
SELECT *
FROM CrimeType;

-- Total Crimes by District over total time
SELECT * 
FROM CriminalCase AS CC INNER JOIN CrimeType as CT ON CC.IUCR = CT.IUCR INNER JOIN Location AS L ON L.Beat = CC.Beat;	

-- Total Primary Crimes by District over total time



-- now rank by district 
SELECT RANK() OVER (PARTITION BY CC.Beat), COUNT(*)
FROM CriminalCase AS CC INNER JOIN CrimeType as CT ON CC.IUCR = CT.IUCR INNER JOIN Location AS L ON L.Beat = CC.Beat;
  



-- 2) Type of Crime count in general by district; based on this you should find which bad crime types are bad
-- rank district by average crime TYPE count aggregated





-- Create a view with bad crime types (containing the arrest by crime type -- the higher the proportion the more intensive the crime to law enforement -- the more o
-- of these crimes the worse!!!
